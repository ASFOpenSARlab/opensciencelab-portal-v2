{# djlint:off H006,H021 #}
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <span id="jupyterhub-logo" class="pull-left">
                <a href="/portal">
                    <img src="/static/img/jh_logo.png"
                         alt="JupyterHub"
                         class="jpy-logo"
                         title="Home" />
                </a>
            </span>
            <button type="button"
                    class="navbar-toggle collapsed"
                    data-toggle="collapse"
                    data-target="#thenavbar"
                    aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse" id="thenavbar">
            <ul class="nav navbar-nav">
                {% for option in nav_bar_options %}
                    {% if option['visible'] %}
                        <li>
                            <a href="{{ option['path'] }}">{{ option['title'] }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <span id="login_widget">
                        <span class="dropdown">
                            <span class="dropdown-toggle"><div class="navbar-text">{{ username }}</div></span>
                            <div class="dropdown-menu">
                                <a href="{{ reset_password_url }}">Reset Password</a>
                                <!-- <a href="{{ reset_mfa_url }}">Reset MFA</a> -->
                                <a class="popup-trigger">Reset MFA</a>
                            </div>
                        </span>
                        <a id="logout"
                           role="button"
                           class="navbar-btn btn-sm btn btn-default"
                           href="{{ logout_url }}">
                            <i aria-hidden="true"
                               class="fa fa-sign-out"
                               style="font-family: 'FontAwesome';
                                      font-weight: 400">
                                Logout
                            </i>
                        </a>
                    </span>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="modal" id="popup-modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Reset MFA</h2>
        <p>
        We are currently developing a self-service workflow for resetting a user's
        MFA configuration. In the meantime, please contact OpenScienceLab admins at
        <a href="mailto:uaf-jupyterhub-admin@alaska.edu">uaf-jupyterhub-admin@alaska.edu</a>
        with the email subject: "OpenScienceLab MFA Reset: {{ username }}".
        </p>
    </div>
</div>

<script>
    const toggle = document.querySelector('.dropdown-toggle');
    const menu = document.querySelector('.dropdown-menu');
    const dropdown = document.querySelector('.dropdown');
    const popupTrigger = document.querySelector('.popup-trigger');
    const modal = document.getElementById('popup-modal');
    const closeBtn = document.querySelector('.close-btn');

    toggle.addEventListener('click', function(e) {
        e.stopPropagation();
        menu.classList.toggle('show');
    });

    document.addEventListener('click', function(e) {
        if (!dropdown.contains(e.target)) {
            menu.classList.remove('show');
        }
    });

    popupTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        menu.classList.remove('show');
        modal.classList.add('show');
    });

    closeBtn.addEventListener('click', function() {
        modal.classList.remove('show');
    });

    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.classList.remove('show');
        }
    });
</script>
