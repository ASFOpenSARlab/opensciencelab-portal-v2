<!DOCTYPE html>
<html lang="en">
    {% include 'head.j2' %}
    <body>
        {% include './noscript.j2' %}
        {% include './navbar.j2' %}
        <div class="horizontal-div">
            <div>
                <div class="horizontal-div">
                    <span>
                        {% if lab.logo is defined and lab.logo != None -%}
                            <img src="/portal/hub/static/img/{{ lab.logo }}"
                                 alt="logo for {{ lab.friendly_name }}" />
                        {% endif %}
                    </span>
                    <legend>{{ lab.friendly_name }}</legend>
                </div>
                {% for user in users %}{{ user }}{% endfor %}
            </div>
            <div>
                <h4>Tools</h4>
                <h5>Manage Users</h5>
                <div>
                    <input type="text" id="user-field">
                    <label for="add-user-btn">Add User</label>
                    <input type="button" id="add-user-btn" onclick="">
                    <label for="remove-user-btn">Remove User</label>
                    <input type="button" id="remove-user-btn">
                </div>
            </div>
        </div>
    </body>
    <script>
        function postAndRefresh(url, data={}){
            fetch(url, {
                method: 'POST',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                // Check response is ok
                if(!response.ok){
                    throw new Error("Request failed");
                }
                return response.json();
            })
            .then(result => {
                // Reload page
                location.reload();
            })
            .catch(error => {
                // Handle Errors
                console.error("Error:", error);
            });
        }
        // Add button listeners
        document.getElementById("add-user-btn").addEventListener('click', function(){
            const username = document.getElementById("user-field").value;
            document.getElementById("user-field").value = "";
            postAndRefresh("/portal/access/manage/{{lab.short_lab_name}}/edituser", { action: "add", username: username });
        });
        document.getElementById("remove-user-btn").addEventListener('click', function(){
            const username = document.getElementById("user-field").value;
            document.getElementById("user-field").value = "";
            postAndRefresh("/portal/access/manage/{{lab.short_lab_name}}/edituser", { action: "remove", username: username });
        });
    </script>
</html>
