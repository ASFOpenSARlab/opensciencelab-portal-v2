{# djlint:off H006,H021 #}
<div>
    <legend>{{ lab.friendly_name }}</legend>
    <div class="lab-logo">
        <span>
            {% if lab.logo is defined and lab.logo != None -%}
                <img class="lab-logo-img"
                     src="/static/img/{{ lab.logo }}"
                     alt="logo for {{ lab.friendly_name }}" />
            {% endif %}
        </span>
    </div>
</div>
{% if exceeded %}
    <div style="border: 2px solid red;
                background-color: lightcoral;
                width:95%;
                vertical-align: middle">
        Search results limited to {{ rowcount }}. Try filtering with <code>?filter=value</code>
    </div>
{% endif %}
<div class="margin-left-30">
    <table>
        <tr class="tr-highlight">
            <th>Username</th>
            <th>Profiles</th>
            <th>Tools</th>
        </tr>
        {% for user in users %}
            <tr>
                <th>
                    <b><a href="/portal/profile/form/{{ user["username"] }}">{{ user["username"] }}</a></b>
                </th>
                <th>
                    {% for profile in lab.allowed_profiles %}
                        {% if profile in user["labs"][lab.short_lab_name]["lab_profiles"] %}
                            <span style="border: 1px solid black; padding: 1px 4px; color: green;">{{ profile }}</span>,
                        {% else %}
                            <span style="border: 1px solid black; padding: 1px 4px; color: red;">{{ profile }}</span>,
                        {% endif %}
                    {% endfor %}
                </th>
                <th>
                    <form method="post" action="{{ lab.short_lab_name }}/edituser">
                        <input type="hidden" name="username" value="{{ user['username'] }}">
                        <button type="submit" name="action" value="remove_user">Remove</button>
                    </form>
                </th>
            </tr>
        {% endfor %}
        <tr>
            <form method="post" action="{{ lab.short_lab_name }}/edituser">
                <th>
                    <input type="text" name="username" placeholder="username">
                </th>
                <th>
                    <input type="text"
                           name="lab_profiles"
                           value="{{ ', '.join(lab.allowed_profiles) }}">
                </th>
                <input type="hidden" name="time_quota" placeholder="time_quota" value="">
                <input type="hidden"
                       name="lab_country_status"
                       placeholder="protected"
                       value="unrestricted">
                <th>
                    <button type="submit" name="action" value="add_user">Add</button>
                </th>
            </form>
        </tr>
    </table>
</div>
<div class="margin-left-30">
    <div class="note">
        Notes on management Interface
        <ul>
            <li>Adding a user that already exists will overwrite their profile permissions</li>
            <li>
                Add several profiles as a comma separated list without quotations
                <br>
                EX: <code>m6a.large, m6a.xlarge</code>
            </li>
        </ul>
    </div>
</div>
